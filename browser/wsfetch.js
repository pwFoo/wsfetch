//  MIT License Copyright (c) 2017 Simon Y. Blackwell
(function(){var e=this,d=function(b){var a=this,d=parseInt(b.statusCode);Object.keys(b).forEach(function(c){a[c]=b[c]});Object.keys(a.headers).forEach(function(c){var b=c.toLowerCase();b!==c&&(a.headers[b]=a.headers[c],delete a.headers[c])});this.ok=200<=d&&400>d?!0:!1;Object.freeze(a)};d.prototype.text=function(){return Promise.resolve(this.body.toString())};d.prototype.json=function(){return Promise.resolve(JSON.parse(this.body.toString()))};d.prototype.exec=function(){return Promise.resolve((new Function("return "+
this.body))())};d.prototype.blob=function(){return Promise.resolve(new Blob(this.body,{type:this.headers["content-type"]}))};d.prototype.valueOf=function(){return this.body};WebSocket.prototype.ready=function(){var b=this;return new Promise(function(a,h){b.addEventListener("open",function(a){});b.addEventListener("message",function(c){if("string"!==typeof c.data||e.msgpack){var f=new FileReader;f.onload=function(a){a=new Uint8Array(this.result);a=new d(e.msgpack.decode(a));b.messages[a.messageid]&&
(b.messages[a.messageid](a),delete b.messages[a.messageid])};f.readAsArrayBuffer(c.data)}else(new Function(c.data)).call(e),a()})})};WebSocket.prototype.fetch=function(b,a){a=void 0===a?{method:"get"}:a;var d=document.createElement("a"),c,f=new Promise(function(a,b){c=a}),g=(Math.random()*Math.random()+"").split(".")[1];this.messages||(this.messages={});this.messages[g]=c;d.href=b;this.send(e.msgpack.encode({url:d.pathname,method:a.method,headers:a.headers,body:a.body,messageid:g}));return f}}).call(this);